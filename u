// Tambahan: Logout
exports.logout = (req, res) => {
  req.session.destroy(err => {
    if (err) {
      return res.send('Gagal logout');
    }
    res.redirect('/login');
  });
};

// Update Login
exports.login = async (req, res) => {
  const { email, password } = req.body;
  const user = await User.findOne({ where: { email } });

  if (user && await bcrypt.compare(password, user.password)) {
    // Simpan data user ke session
    req.session.user = {
      id: user.id,
      name: user.name,
      email: user.email
    };
    res.redirect('/dashboard');
  } else {
    res.send('Email atau password salah');
  }
};

// Dashboard setelah login
exports.dashboard = (req, res) => {
  // Cek apakah user login
  if (!req.session.user) {
    return res.redirect('/login');
  }

  res.send(`Selamat datang, ${req.session.user.name} <a href="/logout">Logout</a>`);
};
